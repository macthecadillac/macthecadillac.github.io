// Hamburger Menu Styles
@use "hamburger";

// Transparent navbar in dark mode on home page and pages without a banner
[data-theme="dark"] body[data-page="home"] #site-nav,
body:not(:has(#banner-container)) #site-nav {
    &::before {
        background: linear-gradient(var(--bg-color), transparent);
        box-shadow: none;
        backdrop-filter: none;
        -webkit-backdrop-filter: none;
    }

    &.scrolled::before {
        background: var(--glass-bg);
        box-shadow: var(--shadow-glass);
        backdrop-filter: var(--blur);
        -webkit-backdrop-filter: var(--blur);
    }

    &.scrolled nav {
        text-shadow: none;
    }
}

@media (prefers-color-scheme: dark) {
    :root:not([data-theme="light"]) body[data-page="home"] #site-nav {
        &::before {
            background: linear-gradient(var(--bg-color), transparent);
            box-shadow: none;
            backdrop-filter: none;
            -webkit-backdrop-filter: none;
        }

        &.scrolled::before {
            background: var(--glass-bg);
            box-shadow: var(--shadow-glass);
            backdrop-filter: var(--blur);
            -webkit-backdrop-filter: var(--blur);
        }

        &.scrolled nav {
            text-shadow: none;
        }
    }
}

// Text shadow applied via JS only after confirming dark mode
body[data-page="home"] #site-nav.dark-nav nav,
body:not(:has(#banner-container)) #site-nav.dark-nav nav {
    text-shadow:
        0 0 0.5rem var(--bg-color),
        0 0 1rem var(--bg-color);
}

body[data-page="home"] #site-nav.dark-nav.scrolled nav,
body:not(:has(#banner-container)) #site-nav.dark-nav.scrolled nav {
    text-shadow: none;
}

#site-nav {
    nav,
    #search-container {
        width: min(var(--container-width) + 15rem, 100% - 1rem);
    }

    #search-results-container {
        background-color: var(--search-bg);
        backdrop-filter: var(--search-blur);
        box-shadow: var(--search-shadow-glass);

        /* Center it relative to the nav bar */
        inset-inline-start: 0;
        inset-inline-end: 0;
        margin-inline: auto;

        /* Force the width to match the theme's content container */
        width: min(var(--container-width) + 15rem, 100% - 1rem);
        max-width: min(var(--container-width) + 15rem, 100% - 1rem);
    }

    #search-results {
        .item {
            background-color: transparent;
        }
    }
}

#site-nav nav {
    a,
    button,
    summary,
    #home a,
    a.active {
        color: var(--fg-color);
    }

    a:hover,
    button:hover,
    summary:hover {
        color: var(--fg-color);
        background-color: var(--fg-muted-1);
    }

    .icon {
        background-color: var(--fg-color);
    }

    a.active,
    #home a.active,
    #theme-switcher .active {
        background-color: transparent;
        box-shadow: none;
        color: var(--fg-color);
    }

    a.active:hover,
    #theme-switcher .active:hover,
    #home a.active:hover {
        background-color: var(--fg-muted-1);
        box-shadow: var(--edge-highlight);
        color: var(--fg-color);
    }
}

#site-nav {
    nav a,
    nav #home a,
    summary {
        font-weight: 300;
        font-family: var(--font-nav-bar);
        text-transform: uppercase;
        font-size: 1.2rem;
    }

    nav #home a {
        .icon {
            display: none;
        }
    }
}

#site-nav {
    @media only screen and (max-width: 480px) {
        position: sticky;
        inset-block-start: 0;
        margin-top: 0; /* Ensure no gap at top */

        #handle {
            display: none; // Hides the Duckquill 'bar' hint to favor your icon
        }
    }
}

// Override the theme's banner rule that pushes the nav down on mobile.
// The theme sets margin-block-start: calc(50vw + 1rem) on #site-nav when a
// banner is present at <=480px, which prevents the sticky positioning above
// from working until the user scrolls past that margin.
@media only screen and (max-width: 480px) {
    body:has(#banner-container) #site-nav:not(#handle + #site-nav) {
        margin-block-start: 0;
    }
}

#site-nav nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap; /* Allow wrapping for expanded menu */
    position: relative;

    .nav-header {
        display: flex;
        list-style: none;
        padding: 0;
        margin: 0;
        order: 0; /* Desktop: First */
    }

    /* Shared styles for both lists */

    .nav-links,
    .nav-icons {
        display: flex;
        list-style: none;
        padding: 0;
        margin: 0;
        align-items: center;
        gap: 0.25rem; /* Add gap for spacing between icons/links */
    }

    .nav-links {
        order: 1; /* Desktop: Middle */
        margin-inline-start: auto; /* Push to right on desktop */
    }

    .nav-icons {
        order: 2; /* Desktop: Last */
    }
}

@media screen and (max-width: 45rem) {
    #site-nav nav {
        /*
           Order on Mobile:
           0: Header (Home)
           1: Icons (Search, Theme)
           2: Hamburger
           3: Menu (Links - full width below)
        */

        .nav-header {
            order: 0;
            margin-inline-end: auto; /* Push everything else to the right */
        }

        .nav-icons {
            order: 1;
            display: flex; /* Always visible */
            margin-inline-end: 0.5rem; /* Space before hamburger */
        }

        .hamburger {
            display: block;
            order: 2;
        }

        .nav-links {
            display: block; /* Hidden by height/opacity, but needs to be layout-ready */
            width: 100%;
            flex-direction: column;
            order: 3; /* Force to bottom */
            /* Transition props */
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transform: translateY(-1rem);
            transition: var(--transition);
            /* Reset visual bubble styles */
            background: transparent;
            box-shadow: none;
            border-radius: 0;
            padding: 0;
            margin: 0;
            pointer-events: none;
            visibility: hidden;
            position: absolute;
            top: 100%;
            left: 0;
            &.is-active {
                /* Reveal */
                max-height: 100vh;
                opacity: 1;
                transform: none;
                pointer-events: auto;
                visibility: visible;
                position: static;
                /* Layout spacing */
                padding-block-start: 1rem;
                display: flex;
                li {
                    margin: 0.25rem 0;
                    width: 100%;
                    text-align: center;
                }
                .divider {
                    display: none;
                }
            }
        }
    }
}

@media screen and (min-width: 45.01rem) {
    #site-nav nav {
        .hamburger {
            display: none;
        }

        .nav-links {
            display: flex;
        }
    }
}
